---
title: "Basic shortwave model exploration"
output:
  html_notebook: default
  html_document:
    df_print: paged
  pdf_document: default
---

### Import the shortwave model code

```{r}
source("shortwave.R")
source("longwave.R")
library(tidyverse)
```

### Define the parameters

```{r}
params <- list(
  rho_leaf = 0.10,                    # Leaf reflectance
  tau_leaf = 0.05,                    # Leaf transmittance
  Kb = 0.58,                          # Direct beam extinction coefficient
  Kd = 0.70,                          # Diffuse extinction coefficient
  beta = 0.54,                        # Upscatter parameter for diffuse radiation
  beta0 = 0.46,                       # Upscatter parameter for direct beam radiation
  clump_OMEGA = 0.75,                 # Clumping coefficient 
  alb_soil_b = 0.1,                   # Soil albedo (direct)  
  alb_soil_d = 0.1,                   # Soil albedo (diffuse)
  em_leaf = .98,                      # Emissivity leaves
  em_soil = 1.00,                     # Emissivity soil
  sigma = 5.67e-08                    # Stefan-Boltzan costant (TODO: Unit)
  
)

params$omega_leaf = params$rho_leaf + params$tau_leaf   # Leaf scattering coefficient
```

### Define the inputs

```{r}
inputs <- list(
  sw_sky_b = 0.8,             # Short wave (sw) direct beam radiation (W m^-2)
  sw_sky_d = 0.2,             # Short wave (sw) diffuse radiation (W m^-2)
  lw_sky = 400,               # Long wave (sw) diffuse radiation (W m^-2)
  t_leaf = 273.15 + 25,
  t_soil =273.15 + 20,
  LAI = 6                     # Leaf Area Index
)

```

### Run the model for the whole shortwave

```{r}
  shortwave_radiation(inputs, params)
```
### Longwave
```{r}
  longwave_radiation(inputs, params)
```


#### Model for direct radiation

```{r}
direct_beam_radiation(inputs, params)
```

#### Model for diffuse radiation

```{r}
diffuse_radiation(inputs, params)
```

### variation of Ic with different LAI


```{#plot(out$LAI, out$Ic, type='l',}
  #     xlab= "LAI", ylab = "Shortwave radiation abosrbed by canopy")
  #lines(out$LAI, out$Ic_sun, col="orange")
  #legend("topleft",                                       # Add legend to plot
  #     legend = c("Total radiation", "Sunlit leaves"),
  #     col = c("black", "orange"),
  #     lty = 1)
  
```

```{r}
  out <- matrix(ncol=4, nrow=15)
  for (lai in 1:15){
    inputs$LAI = lai
    ic = shortwave_radiation(inputs, params)
    out[lai,] = c(lai, ic$ic, ic$ic_sun, ic$ic_sha)
  }

  out <- data.frame(out)
  colnames(out) <- c("LAI", "Ic", "Ic_sun", "Ic_sha")
  
  out %>% tidyr::gather("Radiation_type", "Absorbed_radiation", 2:4) %>% 
    ggplot(.)+
    geom_line(aes(x=LAI, y=Absorbed_radiation, color=Radiation_type))
```

